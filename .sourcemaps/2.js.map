{"version":3,"sources":["../../src/pages/fechar-pedido/fechar-pedido.module.ts","../../src/pages/fechar-pedido/fechar-pedido.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAyC;AACO;AACG;AAUnD;IAAA;IAAqC,CAAC;IAAzB,sBAAsB;QARlC,+DAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,wEAAgB;aACjB;YACD,OAAO,EAAE;gBACP,8DAAe,CAAC,QAAQ,CAAC,wEAAgB,CAAC;aAC3C;SACF,CAAC;OACW,sBAAsB,CAAG;IAAD,6BAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZO;AACiD;AAChD;AAC0B;AACa;AAOlF;IAYE,0BAAmB,OAAsB,EAAS,SAAoB,EAAS,IAAsB,EAAS,SAA0B,EAAS,SAA0B,EAAS,QAA6B;QAA9L,YAAO,GAAP,OAAO,CAAe;QAAS,cAAS,GAAT,SAAS,CAAW;QAAS,SAAI,GAAJ,IAAI,CAAkB;QAAS,cAAS,GAAT,SAAS,CAAiB;QAAS,cAAS,GAAT,SAAS,CAAiB;QAAS,aAAQ,GAAR,QAAQ,CAAqB;QAPjN,eAAU,GAAG,MAAM,CAAC;QAQlB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC;IACvC,CAAC;IAED,2CAAgB,GAAhB;QACE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,EAAC,GAAG,CAAC,CAAC;QACrF,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,IAAI,CAAC,mBAAmB,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,GAAG,UAAU,CAAC;QACrI,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IAC/D,CAAC;IAED,0CAAe,GAAf;QACE,EAAE,EAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,WAAW,IAAI,EAAE,CAAC,EAAC;YAC7D,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAC,OAAO,EAAE,CAAC;QACzD,CAAC;IACH,CAAC;IAED,iCAAM,GAAN;IAEA,CAAC;IAED,0CAAe,GAAf;QACE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,sBAAsB,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;IACpG,CAAC;IAED,wCAAa,GAAb;QACE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,mBAAmB,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;IAC7F,CAAC;IAED,6CAAkB,GAAlB;QACE,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,qBAAqB,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;IACnG,CAAC;IAED,0CAAe,GAAf;QAAA,iBAeC;QAdC,IAAI,CAAC,iBAAiB,EAAE,CAAC,IAAI,CAAC;YAC5B,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,KAAI,CAAC,eAAe,EAAE,EAAE,MAAM,EAAE,KAAI,CAAC,YAAY,EAAE,CAAC,CAAC;YAC/F,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC;iBAC1B,IAAI,CAAC;gBACJ,MAAM,EAAE,KAAI,CAAC,YAAY;gBACzB,OAAO,EAAE,KAAI,CAAC,KAAK;gBACnB,MAAM,EAAE,WAAW;gBACnB,UAAU,EAAE,IAAI,IAAI,EAAE,CAAC,kBAAkB,EAAE;gBAC3C,KAAK,EAAE,KAAI,CAAC,IAAI,CAAC,QAAQ;gBACzB,UAAU,EAAE,KAAI,CAAC,IAAI,CAAC,UAAU;aACjC,CAAC,CAAC,IAAI,CAAC;gBACN,KAAI,CAAC,YAAY,EAAE,CAAC;YACtB,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,CAAC,IAAO,OAAO,CAAC,GAAG,CAAC,8BAA8B,GAAG,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;IACzE,CAAC;IAED,uCAAY,GAAZ;QAAA,iBAmBC;QAlBC,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAChC,KAAK,EAAE,oBAAoB;YAC3B,QAAQ,EAAE,gCAAgC;YAC1C,OAAO,EAAE;gBACP;oBACE,IAAI,EAAE,IAAI;oBACV,OAAO,EAAE;wBACP,KAAI,CAAC,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC;wBAC3B,KAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;wBACxB,KAAI,CAAC,OAAO,CAAC,OAAO,CAAC,+DAAS,CAAC,CAAC;wBAChC,KAAI,CAAC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;wBACjC,KAAI,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,WAAW,GAAG,EAAE,CAAC;wBAC1D,KAAI,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,cAAc,GAAG,EAAE,CAAC;oBAC/D,CAAC;iBACF;aACF;SACF,CAAC,CAAC;QACH,KAAK,CAAC,OAAO,EAAE,CAAC;IAClB,CAAC;IAED,4CAAiB,GAAjB;QAAA,iBAcC;QAbC,MAAM,CAAC,IAAI,OAAO,CAAC,UAAC,OAAO;YACzB,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC;iBACjC,eAAe,EAAE;iBACjB,GAAG,CAAC,iBAAO;gBACR,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,WAAC,IAAI,mBAAG,GAAG,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,IAAK,CAAC,CAAC,OAAO,CAAC,GAAG,EAAE,EAAG,EAA5C,CAA4C,CAAC,CAAC;YAC1E,CAAC,CAAC,CAAC,OAAO,CAAC,UAAC,IAAI;gBACd,KAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;gBACjD,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBAChE,KAAK,CAAC,MAAM,CAAC,CAAC;gBACd,KAAI,CAAC,eAAe,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gBACnC,OAAO,EAAE,CAAC;YACZ,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;IAjGU,gBAAgB;QAJ5B,gEAAS,CAAC;YACT,QAAQ,EAAE,oBAAoB;WACG;SAClC,CAAC;yBAaiN;OAZtM,gBAAgB,CAkG5B;IAAD,CAAC;AAAA;SAlGY,gBAAgB,gB","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { FecharPedidoPage } from './fechar-pedido';\n\n@NgModule({\n  declarations: [\n    FecharPedidoPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(FecharPedidoPage),\n  ],\n})\nexport class FecharPedidoPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/fechar-pedido/fechar-pedido.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, AlertController, ModalController } from 'ionic-angular';\nimport { AbbasPage } from '../abbas/abbas';\nimport { ServicosProvider } from '../../providers/servicos/servicos';\nimport { AngularFireDatabase } from '../../../node_modules/angularfire2/database';\n\n@IonicPage()\n@Component({\n  selector: 'page-fechar-pedido',\n  templateUrl: 'fechar-pedido.html',\n})\nexport class FecharPedidoPage {\n\n  final: any;\n  mostrarQtdeCarrinho: string;\n  totalPagar: any;\n  valorFrete = \"7,00\";\n  totalCompra: any;\n  numeroFinal: any;\n\n  numeroPedido: any;\n  keyNumeroPedido: any;  \n  \n  constructor(public navCtrl: NavController, public navParams: NavParams, public serv: ServicosProvider, public modalCtrl: ModalController, public alertCtrl: AlertController, public database: AngularFireDatabase) {\n    this.final = this.serv.usuarioLogado;\n  }\n\n  ionViewWillEnter() {\n    this.totalPagar = this.serv.calcularTotal(this.valorFrete, this.serv.totalPagar,'+');\n    this.totalCompra = this.serv.totalPagar;\n    this.mostrarQtdeCarrinho = (this.serv.qtdeCarrinho > 1) ? this.serv.qtdeCarrinho + \" produtos\" : this.serv.qtdeCarrinho + \" produto\";\n    this.numeroFinal = this.final.cartaoCredito.numero.slice(-4);\n  }\n\n  ionViewDidEnter(){\n    if(this.serv.usuarioLogado.entregaEscolhida.dataEntrega == \"\"){\n      this.modalCtrl.create('EscolherEntregaPage').present();\n    }\n  }\n\n  voltar(){\n\n  }\n\n  alterarEndereco(){\n    this.modalCtrl.create('CadastroEnderecoPage', { endereco: this.final.enderecoEntrega }).present();\n  }\n\n  alterarCartao(){\n    this.modalCtrl.create('CartaoCreditoPage', { cartao: this.final.cartaoCredito }).present();\n  }\n\n  alterarDataEntrega(){\n    this.modalCtrl.create('EscolherEntregaPage', { entrega: this.final.entregaEscolhida }).present();\n  }\n\n  finalizarCompra(){\n    this.gerarNumeroPedido().then(() => {\n      this.database.list('numeroPedido').update(this.keyNumeroPedido, { numero: this.numeroPedido });\n      this.database.list('pedidos')\n        .push({ \n          pedido: this.numeroPedido,\n          cliente: this.final,\n          status: \"Realizado\",\n          dataPedido: new Date().toLocaleDateString(),\n          items: this.serv.carrinho,\n          totalPagar: this.serv.totalPagar\n        }).then(() => {\n          this.presentAlert();\n        });\n      }).catch((e) => { console.log(\"Erro em gerarNumeroPedido() \" + e) });\n  }\n\n  presentAlert() {\n    let alert = this.alertCtrl.create({\n      title: 'Compra finalizada!',\n      subTitle: 'Acompanhe o status em Pedidos.',\n      buttons: [\n        {\n          text: 'OK',\n          handler: () => {\n            this.serv.qtdeCarrinho = 0;\n            this.serv.carrinho = [];\n            this.navCtrl.setRoot(AbbasPage);\n            this.serv.finalizouCompra = true;\n            this.serv.usuarioLogado.entregaEscolhida.dataEntrega = \"\";\n            this.serv.usuarioLogado.entregaEscolhida.periodoEntrega = \"\";\n          }\n        }\n      ]\n    });\n    alert.present();\n  }\n  \n  gerarNumeroPedido() {\n    return new Promise((resolve) => { \n      this.database.list('numeroPedido')\n      .snapshotChanges()\n      .map(changes => {\n          return changes.map(p => ({ key: p.payload.key, ...p.payload.val() }));\n      }).forEach((item) => {\n        this.numeroPedido = parseInt(item[0].numero + 1);\n        console.log(\"item[0].numero+1 \" + parseInt(item[0].numero + 1));\n        alert(\"Veja\");\n        this.keyNumeroPedido = item[0].key; \n        resolve();\n      });\n    });\n  } \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/fechar-pedido/fechar-pedido.ts"],"sourceRoot":""}